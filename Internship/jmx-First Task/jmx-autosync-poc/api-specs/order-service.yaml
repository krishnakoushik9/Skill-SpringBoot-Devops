openapi: 3.0.3
info:
  title: Order Service API
  description: Microservice for order management and processing
  version: 1.1.0
## Test Auto sync
servers:
  - url: http://localhost:8082/api/v1
    description: Local Development
  - url: https://staging-api.example.com/orders/v1
    description: Staging Environment

tags:
  - name: Orders
    description: Order management
  - name: OrderItems
    description: Order line items
  - name: OrderStatus
    description: Order status tracking
  - name: Returns
    description: Order returns and refunds

paths:
  /orders:
    get:
      operationId: listOrders
      summary: List orders
      description: Retrieve paginated list of orders with filters
      tags:
        - Orders
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, confirmed, processing, shipped, delivered, cancelled]
        - name: customerId
          in: query
          schema:
            type: string
            format: uuid
        - name: fromDate
          in: query
          schema:
            type: string
            format: date
        - name: toDate
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Orders retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'

    post:
      operationId: createOrder
      summary: Create new order
      description: Place a new order
      tags:
        - Orders
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
            example:
              customerId: "550e8400-e29b-41d4-a716-446655440000"
              items:
                - productId: "prod_001"
                  quantity: 2
                  unitPrice: 29.99
                - productId: "prod_002"
                  quantity: 1
                  unitPrice: 49.99
              shippingAddress:
                street: "123 Main Street"
                city: "San Francisco"
                state: "CA"
                zipCode: "94102"
                country: "USA"
              paymentMethod: "credit_card"
      responses:
        '201':
          description: Order created
        '400':
          description: Invalid order data
        '422':
          description: Insufficient inventory

  # NEW ENDPOINT: Search orders
  /orders/search:
    post:
      operationId: searchOrders
      summary: Advanced order search
      description: Search orders with complex filters
      tags:
        - Orders
      requestBody:
        required: true
        content:
          application/json:
            example:
              query: "laptop"
              minTotal: 100
              maxTotal: 5000
              statuses: ["shipped", "delivered"]
              dateRange:
                from: "2025-01-01"
                to: "2025-12-31"
      responses:
        '200':
          description: Search results

  # NEW ENDPOINT: Export orders
  /orders/export:
    get:
      operationId: exportOrders
      summary: Export orders to CSV
      description: Export filtered orders to CSV format
      tags:
        - Orders
      parameters:
        - name: format
          in: query
          schema:
            type: string
            enum: [csv, xlsx, pdf]
            default: csv
        - name: fromDate
          in: query
          schema:
            type: string
            format: date
        - name: toDate
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Export file generated

  /orders/{orderId}:
    get:
      operationId: getOrderById
      summary: Get order details
      description: Retrieve complete order information
      tags:
        - Orders
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Order found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '404':
          description: Order not found

    patch:
      operationId: updateOrder
      summary: Update order
      description: Update order details (before processing)
      tags:
        - Orders
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrderRequest'
            example:
              shippingAddress:
                street: "456 Oak Avenue"
                city: "San Francisco"
                state: "CA"
                zipCode: "94103"
                country: "USA"
      responses:
        '200':
          description: Order updated
        '400':
          description: Order cannot be modified
        '404':
          description: Order not found

  /orders/{orderId}/cancel:
    post:
      operationId: cancelOrder
      summary: Cancel order
      description: Cancel an order (if not yet shipped)
      tags:
        - Orders
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
            example:
              reason: "Changed my mind"
      responses:
        '200':
          description: Order cancelled
        '400':
          description: Order cannot be cancelled
        '404':
          description: Order not found

  # NEW ENDPOINT: Duplicate order
  /orders/{orderId}/duplicate:
    post:
      operationId: duplicateOrder
      summary: Duplicate an order
      description: Create a new order with same items
      tags:
        - Orders
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '201':
          description: Order duplicated
        '404':
          description: Order not found

  /orders/{orderId}/items:
    get:
      operationId: getOrderItems
      summary: Get order items
      description: List all items in an order
      tags:
        - OrderItems
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Items retrieved
        '404':
          description: Order not found

    post:
      operationId: addOrderItem
      summary: Add item to order
      description: Add a new item to existing order
      tags:
        - OrderItems
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderItem'
            example:
              productId: "prod_003"
              quantity: 1
              unitPrice: 19.99
      responses:
        '201':
          description: Item added
        '400':
          description: Cannot modify order
        '404':
          description: Order not found

  /orders/{orderId}/items/{itemId}:
    delete:
      operationId: removeOrderItem
      summary: Remove item from order
      description: Remove a specific item from order
      tags:
        - OrderItems
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: itemId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Item removed
        '400':
          description: Cannot modify order
        '404':
          description: Order or item not found

    patch:
      operationId: updateOrderItem
      summary: Update item quantity
      description: Update quantity of an item in order
      tags:
        - OrderItems
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: itemId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            example:
              quantity: 3
      responses:
        '200':
          description: Item updated
        '404':
          description: Order or item not found

  /orders/{orderId}/status:
    get:
      operationId: getOrderStatus
      summary: Get order status
      description: Get current status and tracking info
      tags:
        - OrderStatus
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Status retrieved
        '404':
          description: Order not found

    put:
      operationId: updateOrderStatus
      summary: Update order status
      description: Update order status (admin only)
      tags:
        - OrderStatus
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [confirmed, processing, shipped, delivered]
                trackingNumber:
                  type: string
                notes:
                  type: string
            example:
              status: "shipped"
              trackingNumber: "1Z999AA10123456784"
              notes: "Shipped via UPS Ground"
      responses:
        '200':
          description: Status updated
        '400':
          description: Invalid status transition
        '404':
          description: Order not found

  /orders/{orderId}/history:
    get:
      operationId: getOrderHistory
      summary: Get order history
      description: Get complete status change history
      tags:
        - OrderStatus
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: History retrieved
        '404':
          description: Order not found

  # NEW SECTION: Returns
  /orders/{orderId}/return:
    post:
      operationId: initiateReturn
      summary: Initiate order return
      description: Start return process for an order
      tags:
        - Returns
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            example:
              reason: "Product damaged"
              items:
                - itemId: "item_001"
                  quantity: 1
              refundMethod: "original_payment"
      responses:
        '201':
          description: Return initiated
        '400':
          description: Order not eligible for return
        '404':
          description: Order not found

    get:
      operationId: getReturnStatus
      summary: Get return status
      description: Check status of return request
      tags:
        - Returns
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Return status retrieved
        '404':
          description: Return not found

  /orders/{orderId}/return/label:
    get:
      operationId: getReturnLabel
      summary: Get return shipping label
      description: Download prepaid return shipping label
      tags:
        - Returns
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Return label generated
        '404':
          description: Return not found

  /returns:
    get:
      operationId: listReturns
      summary: List all returns
      description: Get paginated list of all return requests
      tags:
        - Returns
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, approved, received, refunded, rejected]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Returns list retrieved

components:
  schemas:
    Order:
      type: object
      properties:
        id:
          type: string
          format: uuid
        customerId:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, confirmed, processing, shipped, delivered, cancelled]
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        subtotal:
          type: number
          format: decimal
        tax:
          type: number
          format: decimal
        shipping:
          type: number
          format: decimal
        total:
          type: number
          format: decimal
        shippingAddress:
          $ref: '#/components/schemas/Address'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    OrderItem:
      type: object
      properties:
        id:
          type: string
        productId:
          type: string
        productName:
          type: string
        quantity:
          type: integer
          minimum: 1
        unitPrice:
          type: number
          format: decimal
        totalPrice:
          type: number
          format: decimal

    CreateOrderRequest:
      type: object
      required:
        - customerId
        - items
        - shippingAddress
      properties:
        customerId:
          type: string
          format: uuid
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        shippingAddress:
          $ref: '#/components/schemas/Address'
        paymentMethod:
          type: string

    UpdateOrderRequest:
      type: object
      properties:
        shippingAddress:
          $ref: '#/components/schemas/Address'

    Address:
      type: object
      properties:
        street:
          type: string
        city:
          type: string
        state:
          type: string
        zipCode:
          type: string
        country:
          type: string

    OrderListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Order'
        pagination:
          type: object
          properties:
            page:
              type: integer
            limit:
              type: integer
            total:
              type: integer